<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The English Log â€” Vocabulary</title>

  <!-- Tailwind CDN for quick styling (works for GitHub Pages static site) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Small visual tweak */
    .card { box-shadow: 0 4px 14px rgba(2,6,23,0.08); border-radius: 12px; }
  </style>
</head>
<body class="bg-gradient-to-b from-sky-50 via-white to-sky-100 min-h-screen font-sans text-slate-800">
  <div class="max-w-3xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold">ðŸ“š The English Log</h1>
        <p class="text-sm text-slate-600">Build vocabulary, practice, and export your words â€” simple and fast.</p>
      </div>
      <div id="user-badge" class="text-sm text-slate-600"></div>
    </header>

    <!-- AUTH SECTION -->
    <main id="auth-section" class="card bg-white p-6 mb-6">
      <h2 class="text-lg font-semibold mb-3">Sign up or Log in</h2>
      <div class="space-y-3">
        <input id="email" class="w-full border rounded px-3 py-2" placeholder="Email (example@example.com)" />
        <input id="password" type="password" class="w-full border rounded px-3 py-2" placeholder="Password (local only)" />
        <div class="flex gap-2">
          <button id="btn-login" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded">Login</button>
          <button id="btn-signup" class="flex-1 border px-4 py-2 rounded">Sign Up</button>
        </div>
        <p class="text-xs text-slate-500">This demo stores data locally in your browser (private to your device). For real apps, use a secure backend.</p>
      </div>
    </main>

    <!-- APP SECTION -->
    <section id="app-section" class="hidden">
      <div class="flex items-start justify-between gap-4 mb-4">
        <div class="flex-1 card bg-white p-4">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h3 class="font-semibold">Add a new word</h3>
              <p class="text-sm text-slate-500">Use the "Suggest" button to try auto-filling the meaning.</p>
            </div>
            <div>
              <button id="btn-logout" class="text-sm text-slate-600 underline">Logout</button>
            </div>
          </div>

          <div class="flex gap-2">
            <input id="word-input" class="flex-1 border rounded px-3 py-2" placeholder="Word (e.g. resilient)" />
            <input id="meaning-input" class="flex-1 border rounded px-3 py-2" placeholder="Meaning / translation" />
            <button id="btn-suggest" class="px-3 py-2 border rounded shrink-0">Suggest</button>
            <button id="btn-add" class="px-4 py-2 bg-green-600 text-white rounded">Add</button>
          </div>
          <p id="suggest-msg" class="text-xs text-slate-500 mt-2"></p>
        </div>

        <div class="w-40">
          <div class="card bg-white p-4">
            <h4 class="font-semibold mb-2">Manage</h4>
            <button id="btn-export" class="w-full mb-2 border px-3 py-2 rounded text-sm">Export JSON</button>
            <label class="w-full block">
              <input id="file-import" type="file" accept=".json" class="hidden" />
              <button id="btn-import" class="w-full border px-3 py-2 rounded text-sm">Import JSON</button>
            </label>
            <button id="btn-clear" class="w-full mt-2 text-sm text-red-600">Delete my vocab</button>
          </div>
        </div>
      </div>

      <div class="card bg-white p-4 mb-4">
        <div class="flex gap-2 items-center">
          <input id="search" placeholder="Search words..." class="flex-1 border rounded px-3 py-2" />
          <select id="sort" class="border rounded px-2 py-2">
            <option value="new">Newest</option>
            <option value="alpha">A â†’ Z</option>
          </select>
        </div>
      </div>

      <div id="vocab-list" class="grid gap-3"></div>
    </section>

    <footer class="text-center text-xs text-slate-500 mt-8">
      <div>The English Log â€” local demo â€¢ Not for production authentication</div>
      <div class="mt-2">Want AI-assisted adds later? I can add optional OpenAI integration (requires server or your API key).</div>
    </footer>
  </div>

  <script>
    // === Simple local storage keys and helpers ===
    const LS_USERS = 'el_users';
    const LS_CURRENT = 'el_currentUser';
    const LS_VOCAB = 'el_vocab';

    function loadJSON(key, fallback) {
      try {
        return JSON.parse(localStorage.getItem(key) || 'null') ?? fallback;
      } catch (e) {
        return fallback;
      }
    }
    function saveJSON(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    // Users: { email: password }
    let users = loadJSON(LS_USERS, {});
    // Vocab: { email: [ {word, meaning, createdAt}, ... ] }
    let vocab = loadJSON(LS_VOCAB, {});
    let currentUser = localStorage.getItem(LS_CURRENT);

    // DOM nodes
    const authSection = document.getElementById('auth-section');
    const appSection = document.getElementById('app-section');
    const userBadge = document.getElementById('user-badge');

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const btnLogin = document.getElementById('btn-login');
    const btnSignUp = document.getElementById('btn-signup');

    const wordInput = document.getElementById('word-input');
    const meaningInput = document.getElementById('meaning-input');
    const btnSuggest = document.getElementById('btn-suggest');
    const btnAdd = document.getElementById('btn-add');

    const vocabListEl = document.getElementById('vocab-list');
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');

    const btnLogout = document.getElementById('btn-logout');
    const btnExport = document.getElementById('btn-export');
    const btnImport = document.getElementById('btn-import');
    const fileImport = document.getElementById('file-import');
    const btnClear = document.getElementById('btn-clear');
    const suggestMsg = document.getElementById('suggest-msg');

    // === AUTH functions ===
    function showUI() {
      if (currentUser) {
        authSection.classList.add('hidden');
        appSection.classList.remove('hidden');
        userBadge.textContent = currentUser;
        if (!vocab[currentUser]) vocab[currentUser] = [];
        saveJSON(LS_VOCAB, vocab);
        renderVocab();
      } else {
        authSection.classList.remove('hidden');
        appSection.classList.add('hidden');
        userBadge.textContent = '';
      }
    }

    btnSignUp.addEventListener('click', () => {
      const email = emailInput.value.trim().toLowerCase();
      const pass = passwordInput.value;
      if (!email || !pass) return alert('Enter email and password.');
      if (users[email]) return alert('This email already exists. Please log in.');
      users[email] = pass;
      saveJSON(LS_USERS, users);
      currentUser = email;
      localStorage.setItem(LS_CURRENT, currentUser);
      emailInput.value = '';
      passwordInput.value = '';
      showUI();
    });

    btnLogin.addEventListener('click', () => {
      const email = emailInput.value.trim().toLowerCase();
      const pass = passwordInput.value;
      if (!email || !pass) return alert('Enter email and password.');
      if (!users[email] || users[email] !== pass) return alert('Invalid credentials.');
      currentUser = email;
      localStorage.setItem(LS_CURRENT, currentUser);
      emailInput.value = '';
      passwordInput.value = '';
      showUI();
    });

    btnLogout.addEventListener('click', () => {
      localStorage.removeItem(LS_CURRENT);
      currentUser = null;
      showUI();
    });

    // === VOCAB functions ===
    function renderVocab() {
      const list = (vocab[currentUser] || []).slice();
      const q = (searchInput.value || '').toLowerCase();
      const sort = sortSelect.value;
      if (q) {
        list = list.filter(i => i.word.toLowerCase().includes(q) || (i.meaning || '').toLowerCase().includes(q));
      }
      if (sort === 'alpha') list.sort((a, b) => a.word.localeCompare(b.word));
      else list.sort((a, b) => b.createdAt - a.createdAt);

      vocabListEl.innerHTML = '';
      if (!list.length) {
        vocabListEl.innerHTML = '<div class="bg-white p-4 card text-slate-600">No words yet â€” add your first word!</div>';
        return;
      }

      for (let i = 0; i < list.length; i++) {
        const item = list[i];
        const card = document.createElement('div');
        card.className = 'bg-white p-4 card flex justify-between items-start';
        card.innerHTML = `
          <div>
            <div class="font-semibold text-lg">${escapeHtml(item.word)}</div>
            <div class="text-sm text-slate-600 mt-1">${escapeHtml(item.meaning || '')}</div>
            <div class="text-xs text-slate-400 mt-2">Added: ${new Date(item.createdAt).toLocaleString()}</div>
          </div>
          <div class="text-right ml-4 flex flex-col gap-2">
            <button data-index="${i}" class="btn-delete text-sm text-red-600">Delete</button>
          </div>
        `;
        vocabListEl.appendChild(card);
      }

      // attach delete handlers
      document.querySelectorAll('.btn-delete').forEach(b => {
        b.addEventListener('click', (e) => {
          const idx = Number(e.currentTarget.getAttribute('data-index'));
          vocab[currentUser].splice(idx, 1);
          saveJSON(LS_VOCAB, vocab);
          renderVocab();
        });
      });
    }

    btnAdd.addEventListener('click', () => {
      const w = (wordInput.value || '').trim();
      const m = (meaningInput.value || '').trim();
      if (!w || !m) return alert('Both word and meaning are required.');
      if (!vocab[currentUser]) vocab[currentUser] = [];
      vocab[currentUser].push({ word: w, meaning: m, createdAt: Date.now() });
      saveJSON(LS_VOCAB, vocab);
      wordInput.value = '';
      meaningInput.value = '';
      renderVocab();
    });

    // Search & sort
    searchInput.addEventListener('input', renderVocab);
    sortSelect.addEventListener('change', renderVocab);

    // Export
    btnExport.addEventListener('click', () => {
      const data = { user: currentUser, vocab: vocab[currentUser] || [] };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `english-log-${currentUser || 'vocab'}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // Import
    btnImport.addEventListener('click', () => fileImport.click());
    fileImport.addEventListener('change', (e) => {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const parsed = JSON.parse(reader.result);
          if (!parsed || !Array.isArray(parsed.vocab)) return alert('Invalid file format.');
          vocab[currentUser] = (vocab[currentUser] || []).concat(parsed.vocab.map(it => ({ ...it, createdAt: Date.now() })));
          saveJSON(LS_VOCAB, vocab);
          renderVocab();
        } catch (err) {
          alert('Could not parse file.');
        }
      };
      reader.readAsText(f);
    });

    // Clear vocab
    btnClear.addEventListener('click', () => {
      if (!confirm('Delete all your saved vocabulary? This cannot be undone in this demo.')) return;
      vocab[currentUser] = [];
      saveJSON(LS_VOCAB, vocab);
      renderVocab();
    });

    // Suggest meaning using dictionaryapi.dev (free public API)
    btnSuggest.addEventListener('click', async () => {
      const word = (wordInput.value || '').trim();
      if (!word) return alert('Type the word first.');
      suggestMsg.textContent = 'Looking up definitionâ€¦';
      try {
        const res = await fetch('https://api.dictionaryapi.dev/api/v2/entries/en/' + encodeURIComponent(word));
        if (!res.ok) throw new Error('No definition found');
        const data = await res.json();
        // Try to find first definition text
        const meaning = (data && data[0] && data[0].meanings && data[0].meanings[0] && data[0].meanings[0].definitions && data[0].meanings[0].definitions[0] && data[0].meanings[0].definitions[0].definition) || '';
        if (meaning) {
          meaningInput.value = meaning;
          suggestMsg.textContent = 'Definition filled from dictionary API.';
        } else {
          suggestMsg.textContent = 'Definition not found.';
        }
      } catch (err) {
        suggestMsg.textContent = 'Could not fetch suggestion (network or not found).';
      }
      setTimeout(() => { suggestMsg.textContent = ''; }, 3500);
    });

    // small HTML escape helper
    function escapeHtml(str) {
      return String(str || '').replace(/[&<>"]/g, (s) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[s]));
    }

    // Init on load
    (function init() {
      // ensure objects exist
      users = users || {};
      vocab = vocab || {};
      showUI();
    })();

    // Expose for debugging in console
    window._el = { users, vocab };
  </script>
</body>
</html>
